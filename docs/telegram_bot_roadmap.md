# Telegram Bot Integration Roadmap & TODO

Legend: âœ… done, ðŸŸ¡ pending, â›” blocked

## Tasks
- âœ… [TB01] Define bot persona, command set, and interaction modes (slash commands + inline keyboards). (Standalone)
- âœ… [TB02] Lock Telegram library and transport: `aiogram` with webhook delivery. (Standalone)
- âœ… [TB03] Auth: allowlisted Telegram user IDs (config/secret). (Standalone)
- âœ… [TB04] Control surface: internal Python API to start/stop/list/resume runs (no CLI wrapping). (Standalone)
- âœ… [TB05] Hosting/deploy: sidecar service on same VM (systemd) with FS access to `strix_runs`; webhook ingress HTTPS. (Depends: TB02)
- âœ… [TB06] Control API/service to start/stop/resume/list runs (wrap `interface/main.py` internally). (Standalone)
- âœ… [TB07] Run status/query surface for listing runs and fetching metadata/logs. (Depends: TB06)
- âœ… [TB08] Resume mechanism; fall back with clear messaging if not possible. (Depends: TB06)
- âœ… [TB09] Secure internal API surface (auth tokens/ACL) and restrict webhook IPs. (Depends: TB06)
- âœ… [TB10] Commands `/start`, `/help`, `/newrun`, `/runs`, `/run <id> ...`, `/resume` (graceful), `/stop`, `/verbosity`. (Depends: TB06)
- âœ… [TB11] Inline keyboards (report/file nav/verbosity). (Depends: TB10)
- âœ… [TB12] Clear errors + rate-limit notices. (Depends: TB10)
- âœ… [TB12b] Per-run verbosity preference. (Depends: TB10)
- âœ… [TB12c] Truncate long summaries to fit message limits. (Depends: TB10)
- âœ… [TB13] Streaming via tracer callbacks; verbosity (high-only/batched/full). (Depends: TB06, TB10, TB12b)
- âœ… [TB14] Log tailing hook for pagination. (Depends: TB06, TB07)
- âœ… [TB15] Severity-based formatting and batching refinements. (Depends: TB13)
- âœ… [TB16] Locate reports in `strix_runs/<run_name>`. (Depends: TB06)
- âœ… [TB17] File transfer with size guards (report + generic files). (Depends: TB10, TB16)
- âœ… [TB18] Summary + on-demand full report buttons. (Depends: TB10, TB16)
- âœ… [TB19] List runs with metadata via buttons. (Depends: TB06)
- âœ… [TB20] Navigate run directories with buttons. (Depends: TB10, TB19)
- âœ… [TB21] Fetch/send specific files; sanitize paths. (Depends: TB19)
- âœ… [TB22] Search/filter runs (target/date/severity). (Depends: TB19)
- âœ… [TB23] Docs excerpts via `/docs`. (Standalone)
- âœ… [TB24] Contextual doc suggestions (throttled). (Depends: TB23)
- âœ… [TB25] Allowlist auth enforced (env + runtime guard). (Standalone)
- âœ… [TB26] Redact secrets by default (token-like prefixes). (Standalone)
- âœ… [TB27] Audit logging + global rate limits. (Depends: TB10)
- âœ… [TB27b] Secret management: env/BOT_TOKEN_FILE, secret manager/systemd drop-ins documented. (Standalone)
- âœ… [TB28] Persist bot session state (verbosity) in SQLite. (Standalone)
- âœ… [TB29] Cache run metadata (FS run list cache with TTL). (Depends: TB28)
- âœ… [TB30] Package for systemd; health checks (/health, /healthz). (Depends: TB05, TB10)
- âœ… [TB31] CI pipeline to lint/test bot; deploy via artifact + systemd updates. (Standalone)
- âœ… [TB32] Manage secrets for bot token/API keys via env/secret manager/BOT_TOKEN_FILE guidance. (Depends: TB27b)
- âœ… [TB33] Metrics (commands, errors, latency, message volume) via backend (Prom/exporter). (Standalone)
- âœ… [TB34] Structured logs for commands/API/file transfers. (Standalone)
- âœ… [TB35] Alerting on delivery/API failures. (Depends: TB33, TB34)
- âœ… [TB36] Unit tests for command parsing/handlers (aiogram). (Standalone)
- âœ… [TB37] Integration tests against Strix internal API mocks; FS fixtures. (Depends: TB06)
- âœ… [TB38] E2E test in staging Telegram chat. (Depends: TB10, TB30)
- âœ… [TB39] Load test for vulnerability message bursts. (Depends: TB13, TB17)
- âœ… [TB39b] Regression test for missing env vars. (Standalone)
- âœ… [TB39c] Regression test for HTTP endpoints (`/health`, `/healthz`, `/metrics`). (Depends: TB30, TB33)
- âœ… [TB39d] Regression test for severity/batch streaming filters. (Depends: TB13)
- âœ… [TB39e] Regression test for state persistence (verbosity). (Depends: TB28)
- âœ… [TB40] `docs/telegram_bot_usage.md`. (Standalone)
- âœ… [TB41] `docs/telegram_bot_architecture.md`. (Standalone)
- âœ… [TB42] Update `docs/setup-and-running.md` with bot deploy steps. (Depends: TB30)
- âœ… [TB43] Update `docs/troubleshooting.md` with bot-specific issues. (Depends: TB10, TB13, TB33)
- âœ… [TB44] Pilot with allowlisted internal users; gather feedback. (Depends: TB30)
- âœ… [TB45] Harden based on feedback (UX tweaks, rate limits, verbosity defaults). (Depends: TB44)
- âœ… [TB46] Announce feature; add to README/marketing if desired. (Depends: TB45)

## Execution checklist
- [ ] Confirm webhook URL/cert availability; store bot token securely (env/secret manager/BOT_TOKEN_FILE).
- [ ] Add feature flags/toggles so bot can be disabled without impacting core Strix.
- [ ] Implement control API behind auth; never expose unauthenticated endpoints.
- [ ] Run unit/integration tests locally (commands, control API, FS browsing sanitization).
- [ ] Verify rate limiting/batching in staging chat before production.
- [ ] Validate report file size handling and path sanitization for `strix_runs`.
- [ ] Ensure telemetry hooks do not block agent loop (use async/background).
- [ ] Deploy behind systemd with health check; confirm restart policy.
- [ ] If HTTP endpoints enabled, verify `/healthz` and `/metrics` are reachable and secured.
- [ ] Post-deploy sanity: create run, receive vuln notifications, fetch summary/full report, browse files, fetch docs.
- [ ] Rollback plan ready (disable bot via flag/env; stop systemd service) if issues arise.
